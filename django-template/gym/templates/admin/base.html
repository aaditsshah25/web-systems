{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static 'css/admin_custom.css' %}">
{% endblock %}

{% block branding %}
<h1 id="site-name">
  <a href="{% url 'admin:index' %}">
    Gym Booking Admin
  </a>
</h1>
{% endblock %}

<!-- Change in slots.html and bookings.html -->
<td>{{ slot.date|date:"D, j M Y" }}</td>
<td>{{ slot.start_time|time:"g:i A" }}</td>
<td>{{ slot.end_time|time:"g:i A" }}</td>

<!-- Add to your forms -->
<button type="submit" class="btn" id="submitBtn">
    <span id="btnText">Book</span>
    <span id="btnLoading" style="display:none;">
        <span class="loading-spinner"></span>
    </span>
</button>

<!-- Add JavaScript -->
<script>
document.querySelector('form').addEventListener('submit', function() {
    document.getElementById('btnText').style.display = 'none';
    document.getElementById('btnLoading').style.display = 'inline-block';
});
</script>

# Add to views.py
@login_required
def view_bookings_view(request):
    """Render the user's bookings page with search capability."""
    search_query = request.GET.get('search', '')
    date_filter = request.GET.get('date', '')
    
    bookings = Booking.objects.filter(user=request.user).select_related('slot')
    
    if search_query:
        bookings = bookings.filter(slot__date__icontains=search_query)
    
    if date_filter:
        bookings = bookings.filter(slot__date=date_filter)
        
    return render(request, 'gym/bookings.html', {
        'bookings': bookings,
        'search_query': search_query,
        'date_filter': date_filter
    })

# Modify view_slots_view in views.py
from django.core.paginator import Paginator

@login_required
def view_slots_view(request):
    """Render the available slots page with pagination."""
    today = timezone.now().date()
    all_slots = Slot.objects.filter(date__gte=today)
    
    paginator = Paginator(all_slots, 10)  # Show 10 slots per page
    page_number = request.GET.get('page', 1)
    slots = paginator.get_page(page_number)
    
    return render(request, 'gym/slots.html', {'slots': slots})